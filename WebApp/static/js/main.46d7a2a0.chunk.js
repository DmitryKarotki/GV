(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,n){},17:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(8),i=n.n(s),r=(n(15),n(1)),l=n(2),c=n(3),h=n(6),u=n(4),d=n(5),f=(n(17),function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(h.a)(this,Object(u.a)(t).call(this))).onChange=function(t){var n=e.props.app,a=t.target.value,o=n.state.charsets[a];n.mDo("Charset",o[0],o[1]),e.setState({value:a}),n.appRef.current.focus()},e.state={value:0},e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.app.state.charsets;if(!e)return null;var t=e.map(function(e,t){return o.a.createElement("option",{key:t,value:t},e[0])});return o.a.createElement("select",{className:"charsets",title:"Code page",value:this.state.value,onChange:this.onChange},t)}}]),t}(o.a.Component)),m=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(h.a)(this,Object(u.a)(t).call(this))).handleResize=function(){clearTimeout(e.tmp),e.tmp=setTimeout(function(){var e=this.props.app,t=e.state.selected;return e.mResize(t),null}.bind(Object(r.a)(Object(r.a)(e))),250)},e.treeRef=o.a.createRef(),e.tmp=null,e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize);var e=this.props.app;0==e.heightRow&&(e.heightRow=this.treeRef.current.firstChild.offsetHeight)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"getClientHeight",value:function(){return this.treeRef.current.parentElement.clientHeight}},{key:"onClick",value:function(e){var t=this.props.app,n=e.target,a=e.currentTarget.id;"SPAN"==n.tagName&&(-1==n.className.indexOf("tree-expanded")&&-1==n.className.indexOf("tree-collapsed")||t.mDo("Click",t.state.kolrow,a)),a!=t.state.selected&&t.setState({selected:a})}},{key:"onDoubleClick",value:function(e){var t=this.props.app,n=t.state.data,a=e.target,o=e.currentTarget.id,s=n[o-1][2];if("SPAN"==a.tagName)if(-1!=a.className.indexOf("tree-inden")){var i=Math.ceil(a.offsetLeft/a.offsetWidth);s[1]>i&&t.mDo("DClick",o,i)}else if(-1!=a.className.indexOf("tree-title")){var r=a.innerText.trim();-1!=r.indexOf(") =")&&(r=r.split(") =")[0]+")"),t.refs.GoToInput.value=r}}},{key:"render",value:function(){var e=this.props.app,t=e.state.data,n=e.flexRow,a=[];if(t.length&&e.state.kolrow>0)for(var s=t.length<e.state.kolrow?t.length:e.state.kolrow,i=0;i<s;i++){for(var r=i+1,l=t[i],c=[],h="tree-indent",u=1;u<l[2][1];u++)c.push(o.a.createElement("span",{className:h},"\xa0"));l[2][0]>=10&&(h=1==l[2][2]?"tree-expanded":"tree-collapsed"),c.push(o.a.createElement("span",{className:h},"\xa0")),h=l[2][0]<10?"tree-file":1==l[2][2]?"tree-folder-open":"tree-folder",c.push(o.a.createElement("span",{className:h},"\xa0"));var d="^"+e.global+"("+l[0]+")"+(l[2][0]%10?" = "+l[1]:"");c.push(o.a.createElement("span",{className:"tree-title",title:e.state.selected==r?d:""},"\xa0",d)),h=e.state.selected==r?"SelectedRow":"",h+=n?" flex-fill":"",a.push(o.a.createElement("li",{className:h,key:l[0],id:r,onClick:this.onClick.bind(this),onDoubleClick:this.onDoubleClick.bind(this)},c))}else a.push(o.a.createElement("li",null,o.a.createElement("span",{className:"tree-indent"},"\xa0"),o.a.createElement("span",{className:"tree-title"},"\xa0")));return o.a.createElement("ul",{className:"tree"+(n?" d-flex":""),ref:this.treeRef},a)}}]),t}(o.a.Component),p=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(h.a)(this,Object(u.a)(t).call(this))).onMenuClick=function(e){e.currentTarget.nextSibling.classList.toggle("show")},e.onGlobalClick=function(t){var n=t.currentTarget.id;e.global=n,e.setState({selected:1}),e.mDo("New","^"+n),e.appRef.current.focus()},e.onGoTo=function(t){var n=e.refs.GoToInput.value;if(""!=n){var a=e.getKolRow();e.setState({kolrow:a}),e.mDo("GoTo",n,a),e.appRef.current.focus()}},e.renderGlobals=function(){if(!e.state.globals)return null;var t=e.state.globals.substring(1).split("^"),n=[];return t.map(function(t,a){n.push(o.a.createElement("button",{key:t,id:t,className:"global",onClick:e.onGlobalClick},"^"+t))}),o.a.createElement("div",{className:"globals dropdown"},o.a.createElement("button",{className:"dropbtn",onClick:e.onMenuClick},"Globals"),o.a.createElement("div",{className:"dropdown-content"},n,o.a.createElement("div",{className:"goto"},o.a.createElement("input",{ref:"GoToInput",type:"text",placeholder:"Global reference"}),o.a.createElement("button",{onClick:e.onGoTo},"Go"))))},e.onDownloadClick=function(t){""===e.global?alert("Please select global"):e.downloading?alert("Loading in progress..."):(e.downloading=!0,e.refs.BtnDownload.disabled=!0,e.mDo("Download",1===+t.currentTarget.id?e.state.selected:"")),e.appRef.current.focus(),t.preventDefault()},e.renderDownload=function(){return""!=e.global?o.a.createElement("div",{className:"download dropdown"},o.a.createElement("button",{className:"dropbtn",ref:"BtnDownload",onClick:e.onMenuClick},"Download"),o.a.createElement("div",{className:"dropdown-content"},o.a.createElement("a",{id:"1",href:"#download",onClick:e.onDownloadClick},"Current global node"),o.a.createElement("a",{id:"2",href:"#download",onClick:e.onDownloadClick},"Whole global variable"))):null},e.renderInfo=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"info"},e.state.info),o.a.createElement("span",{className:"info2"},""))},e.state={selected:1,kolrow:0,data:[],globals:null,charsets:null},e.global="",e.heightRow=0,e.appRef=o.a.createRef(),e.socket=!1,e.scr=0,e.downloading=!1,e.flexRow=!1,e.tmp=null,e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.appRef.current;t.focus();var n=window.location.href.split("/")[2];n="ws://"+n+"/",this.ws=new WebSocket(n),this.ws.onopen=function(){this.socket=!0,this.mDo("Begin")},this.ws.onopen=this.ws.onopen.bind(this),this.ws.onclose=function(){this.socket=!1,this.global="",this.setState({info:"Disconnect",data:[],globals:null,charsets:null})},this.ws.onclose=this.ws.onclose.bind(this),this.ws.onmessage=function(e){if(e.data){var t=JSON.parse(e.data);t.fn&&this["m"+t.fn].apply(this,t.arg)}},this.ws.onmessage=this.ws.onmessage.bind(this);var a=function(t){e.tmp&&(clearInterval(e.tmp),e.tmp=null)};window.addEventListener("mouseup",a),window.addEventListener("touchend",a),a=function(t){if(e.scr<3&&!e.tmp){var n=t.target;if("SPAN"==n.tagName&&(n=n.parentElement),-1!=n.className.indexOf("SelectedRow")){var a=n.id;1!=a&&a!=e.state.kolrow||e.toScroll(a)}}},t.addEventListener("mousedown",a),t.addEventListener("touchstart",a),window.addEventListener("click",function(e){if(!e.target.matches(".dropbtn")&&"INPUT"!=e.target.tagName)for(var t=document.getElementsByClassName("dropdown-content"),n=0;n<t.length;n++){var a=t[n];a.classList.contains("show")&&a.classList.remove("show")}})}},{key:"byteLength",value:function(e){for(var t=e.length,n=e.length-1;n>=0;n--){var a=e.charCodeAt(n);a>127&&a<=2047?t++:a>2047&&a<=65535&&(t+=2)}return t}},{key:"sendMessage",value:function(e){var t=this.byteLength(e),n=String.fromCharCode(Math.trunc(t/95)%95+32,t%95+32);this.ws.send(String.fromCharCode(126).repeat(4)+n+e)}},{key:"onKeyDown",value:function(e){if(!this.state.data.length||"INPUT"==e.target.tagName)return null;var t=this.state.selected,n=e.key,a=Math.min(this.state.data.length,this.state.kolrow);if("ArrowRight"==n&&e.ctrlKey)return this.mDo("CtrlRight",t),null;if("+"==n||"ArrowRight"==n||"-"==n||"ArrowLeft"==n){var o=this.state.data[t-1][2];if(o[0]>1&&(1==o[2]&&("-"==n||"ArrowLeft"==n)||1!=o[2]&&("+"==n||"ArrowRight"==n)))return this.mDo("Click",this.state.kolrow,t),null;if("ArrowLeft"==n&&o[1]>1)return this.mDo("Left",t,o[1]),null}"ArrowUp"==n||"ArrowLeft"==n?t>1?t--:this.mDo("Key","ArrowUp",t):"ArrowDown"==n||"ArrowRight"==n?t<a?t++:this.mDo("Key","ArrowDown",t):"PageUp"==n?t>1?t=1:this.mDo("Key",n,t):"PageDown"==n?t<a?t=a:this.mDo("Key",n,t):"Home"==n?(this.scr<3&&this.mDo("Key",n,t),t=1):"End"==n&&(this.scr<3&&this.mDo("Key",n,t),t=a),this.state.selected!=t&&this.setState({selected:t})}},{key:"onWheel",value:function(e){var t=this.state.selected,n=Math.min(this.state.data.length,this.state.kolrow);e.deltaY<0?t>1?t--:this.mDo("Key","ArrowUp",t):e.deltaY>0&&(t<n?t++:this.mDo("Key","ArrowDown",t)),this.state.selected!=t&&this.setState({selected:t})}},{key:"onMouseMove",value:function(e){var t=this;if(("touchmove"==e.type||"mousemove"==e.type&&1===e.buttons)&&e.target){var n=e.target;if("LI"==n.tagName&&this.state.selected!=n.id)return this.tmp&&(clearInterval(this.tmp),this.tmp=null),this.setState({selected:n.id}),null;if(this.scr<3&&!this.tmp){var a=this.refs.Tree.treeRef.current;if(e.clientY<a.offsetTop)this.setState({selected:1}),this.tmp=setInterval(function(){return t.mDo("Key","ArrowUp",1)},100);else if(e.clientY>a.offsetTop+a.offsetHeight){var o=this.state.kolrow;this.setState({selected:o}),this.tmp=setInterval(function(){return t.mDo("Key","ArrowDown",o)},100)}}e.preventDefault()}}},{key:"toScroll",value:function(e){var t=this;this.tmp=1==e?setInterval(function(){return t.mDo("Key","ArrowUp",1)},100):setInterval(function(){return t.mDo("Key","ArrowDown",e)},100)}},{key:"getKolRow",value:function(){var e=Math.trunc(this.refs.Tree.getClientHeight()/this.heightRow);return"undefined"!==typeof InstallTrigger&&this.refs.Tree.getClientHeight()%this.heightRow<Math.trunc(this.heightRow/2)&&(e-=1),e}},{key:"mDo",value:function(){this.sendMessage(JSON.stringify(Array.from(arguments)))}},{key:"mBegin",value:function(e,t,n){var a=this;this.setState({info:t,globals:e}),0==n&&fetch("/data/charsetData.json").then(function(e){return e.json()}).then(function(e){a.setState({charsets:e})})}},{key:"mNew",value:function(e){if(e>0){var t=this.getKolRow();this.setState({kolrow:t}),this.mDo("Reload","",t,this.state.selected)}else this.global="",this.setState({data:[]})}},{key:"mResize",value:function(e){var t=this.getKolRow();this.setState({kolrow:t}),this.mDo("Resize",t,e)}},{key:"mReload",value:function(e,t,n){0==+e?(this.mDo("Screen",t),this.setState({selected:n})):this.setState({data:[]})}},{key:"mGoTo",value:function(e,t,n){this.global=e.split("^")[1],this.mDo("Screen",t),this.setState({selected:n}),this.refs.GoToInput.value=""}},{key:"mScreen",value:function(e,t){this.scr=t,e.length<this.state.kolrow?this.flexRow=!1:this.flexRow=!0,this.setState({data:e})}},{key:"mDownload",value:function(e){if(this.downloading=!1,this.refs.BtnDownload.disabled=!1,""!==e){var t="http://"+this.ws.url.split("/")[2]+"/";window.open(t+e)}}},{key:"render",value:function(){var e=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header"},this.renderGlobals(),o.a.createElement(f,{app:this}),this.renderDownload()),o.a.createElement("div",{className:"main"},o.a.createElement(m,{ref:"Tree",app:this})),o.a.createElement("div",{className:"footer"},this.renderInfo()));return o.a.createElement("div",{className:"app disable-selection",ref:this.appRef,contentEditable:!1,tabIndex:"0",onKeyDown:this.onKeyDown.bind(this),onWheel:this.onWheel.bind(this),onMouseMove:this.onMouseMove.bind(this)},e)}}]),t}(o.a.Component),w=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function v(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(o.a.createElement(p,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");w?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):v(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):v(t,e)})}}()},9:function(e,t,n){e.exports=n(19)}},[[9,2,1]]]);
//# sourceMappingURL=main.46d7a2a0.chunk.js.map